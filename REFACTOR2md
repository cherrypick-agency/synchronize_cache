### Топ DX‑улучшений (продуманно, с приоритетом)

Ниже — **сначала non‑breaking**, потом **vNext major (breaking)**. Для каждого: **польза**, **уверенность что это реально лучше**, **уверенность что я сделаю без ошибок**.

## Non‑breaking (можно делать уже сейчас)

### 1) Outbox “reactive” вместо polling в `SyncCoordinator`
- **Что**: добавить в outbox API `watchPendingCount()` / `watchHasOperations()` на Drift `watch()`, и перевести `SyncCoordinator` с таймера на stream.
- **Почему лучше**: меньше батареи/IO, мгновенная реакция на enqueue, проще тестировать, меньше “магии” с дебаунсом.
- **Польза**: 10/10  
- **Уверенность что лучше**: 10/10  
- **Уверенность без ошибок**: 8/10 (нужно аккуратно с жизненным циклом и backpressure)

### 2) “Quarantine / dead-letter” для залипших операций
- **Что**: хранить `tryCount + lastError + lastTriedAt` для outbox op (таблица или отдельная), после N попыток помечать как “stuck”, чтобы `sync()` не пытался их бесконечно.
- **Почему лучше**: прод‑стабильность и поддержка: видно *что именно* не уходит, можно “retry / drop / inspect”.
- **Польза**: 9/10  
- **Уверенность что лучше**: 9/10  
- **Уверенность без ошибок**: 7/10 (потребует схемы/миграции и чёткой политики)

### 3) Единый слой retry/backoff (убрать “двойные ретраи”)
- **Что**: сделать **один** authoritative retry‑механизм:
  - либо engine‑level wrapper `RetryingTransportAdapter(transport, policy)`
  - либо transport‑only retry, а engine перестаёт ретраить network.
- **Почему лучше**: предсказуемость, одна настройка, легче дебажить “почему так долго”.
- **Польза**: 10/10  
- **Уверенность что лучше**: 9/10  
- **Уверенность без ошибок**: 7/10 (много edge cases: 429, идемпотентность, таймауты)

### 4) Нормальная модель результата синка (не только `SyncStats`)
- **Что**: добавить новый return‑тип, например `SyncRunResult`, где есть:
  - `push: PushStats`, `pull: PullStats`
  - `hadErrors`, `firstError`, `stuckOpsCount`, `duration`
  - `kindsPushed/kindsPulled`
- **Почему лучше**: приложению проще строить UI/логирование/метрики без парсинга events.
- **Польза**: 9/10  
- **Уверенность что лучше**: 9/10  
- **Уверенность без ошибок**: 8/10

### 5) События прогресса: сделать “честные” и удобные
- **Что**: сейчас `SyncProgress(done, total)` по pull фактически `total=done`. Лучше:
  - либо `SyncProgress(done, total?)` (unknown total)
  - либо новые события `PullPageProcessed(kind, pageSize, totalDone)` и `PushBatchProcessed(...)`.
- **Почему лучше**: UI прогресса перестанет “врать”, отладка проще.
- **Польза**: 8/10  
- **Уверенность что лучше**: 9/10  
- **Уверенность без ошибок**: 7/10 (нужно сохранить обратную совместимость событий)

### 6) Стандартизировать ошибки (категории + коды)
- **Что**: нормализовать ошибки в единый формат: `SyncException(category: network/auth/server/parse/conflict, retryable: bool, statusCode?)`.
- **Почему лучше**: приложение может одинаково решать “показать retry / logout / молча подождать”.
- **Польза**: 8/10  
- **Уверенность что лучше**: 9/10  
- **Уверенность без ошибок**: 8/10

---

## Breaking / vNext major (имеет смысл, если хотим очень чистый API)

### 7) `TransportAdapter v2`: transport **throws** на network/5xx, а per‑op результат только для 2xx/404/409
- **Что**: убрать концепцию “`PushError` как обычный результат” из push‑контракта. Ошибки транспорта (timeout/5xx/invalid JSON) → исключения; конфликт/404 → типизированные результаты.
- **Почему лучше**: engine может корректно применять retry/backoff; исчезают “частично успешные батчи с ошибками непонятно ретраить ли”.
- **Польза**: 9/10  
- **Уверенность что лучше**: 9/10  
- **Уверенность без ошибок**: 6/10 (breaking API + нужно продумать миграцию и адаптер совместимости)

### 8) Типизированные конфликты `Conflict<T>` и `SyncableTable<T>`‑интеграция глубже
- **Что**: чтобы `conflictResolver` получал `Conflict<T>` (local/server как `T`), а не `Map`.
- **Почему лучше**: меньше runtime ошибок/кастов, удобнее писать manual merge/resolution.
- **Польза**: 9/10  
- **Уверенность что лучше**: 8/10  
- **Уверенность без ошибок**: 6/10 (много дженериков + нужно аккуратно с JSON/Insertable)

### 9) Полный вынос legacy из `SyncConfig` и удаление legacy `kinds`
- **Что**: удалить deprecated поля/параметры в следующем major.
- **Почему лучше**: чистый публичный API без “устаревших хвостов”.
- **Польза**: 7/10  
- **Уверенность что лучше**: 9/10  
- **Уверенность без ошибок**: 9/10

---

### Мой “самый правильный” топ‑план по итерациям
- **Итерация A (максимум пользы, минимум риска)**: №1 + №4 + №6  
- **Итерация B (прод‑стабильность)**: №2  
- **Итерация C (архитектурная чистота)**: №3, а затем уже думать про v2 (№7) как основу для major
